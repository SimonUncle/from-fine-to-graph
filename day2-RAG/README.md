# Day 2 - Advanced RAG Systems: Naive â†’ Advanced â†’ Modular

## ğŸ¯ ê³¼ì • ê°œìš”

ì´ ê³¼ì •ì€ RAG(Retrieval-Augmented Generation) ì‹œìŠ¤í…œì„ ë‹¨ê³„ì ìœ¼ë¡œ ë°œì „ì‹œì¼œë‚˜ê°€ëŠ” ì‹¤ìŠµ ì¤‘ì‹¬ ì»¤ë¦¬í˜ëŸ¼ì…ë‹ˆë‹¤. Naive RAGë¶€í„° ì‹œì‘í•˜ì—¬ ìµœì‹  Modular RAGê¹Œì§€, ì‹¤ë¬´ì—ì„œ ë°”ë¡œ ì ìš© ê°€ëŠ¥í•œ ê³ ê¸‰ ê¸°ë²•ë“¤ì„ ì²´ê³„ì ìœ¼ë¡œ í•™ìŠµí•©ë‹ˆë‹¤.

### ğŸ“š ì»¤ë¦¬í˜ëŸ¼ êµ¬ì„±

| ë…¸íŠ¸ë¶ | ì œëª© | ì‹œê°„ | í•µì‹¬ ë‚´ìš© |
|-------|------|------|----------|
| 00 | RAG ì´ë¡  ê°œìš” | 60ë¶„ | RAG ì§„í™” ê³¼ì •, ìµœì‹  íŠ¸ë Œë“œ |
| 01 | Naive RAG ë² ì´ìŠ¤ë¼ì¸ | 60ë¶„ | ê¸°ë³¸ RAG íŒŒì´í”„ë¼ì¸, ì„±ëŠ¥ ì¸¡ì • |
| 02 | ì‹¤íŒ¨ ì‚¬ë¡€ ë¶„ì„ | 60ë¶„ | 5ê°€ì§€ ì‹¤íŒ¨ íŒ¨í„´, ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ |
| 03 | ê³ ê¸‰ ì¿¼ë¦¬ ê°œì„  | 75ë¶„ | Multi-Query, Sub-Question, RAG-Fusion |
| 04 | ë©”íƒ€ë°ì´í„° í•„í„°ë§ | 60ë¶„ | ì‹œê°„/ì¹´í…Œê³ ë¦¬ ê¸°ë°˜ ì •ë°€ í•„í„°ë§ |
| 05 | í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ | 75ë¶„ | BM25+Vector, RRF, Cross-encoder |
| 06 | ëª¨ë“ˆëŸ¬ RAG | 90ë¶„ | Query Router, Self-RAG, Adaptive Selection |
| 07 | ì¸í„°ë™í‹°ë¸Œ ë¹„êµ | 45ë¶„ | í†µí•© ë¹„êµ, ì¶”ì²œ ì‹œìŠ¤í…œ, ë²¤ì¹˜ë§ˆí¬ |

**ì´ í•™ìŠµ ì‹œê°„**: 525ë¶„ (8ì‹œê°„ 45ë¶„)

## ğŸš€ ì‹œì‘í•˜ê¸°

### í™˜ê²½ ì„¤ì •

```bash
# ê°€ìƒí™˜ê²½ ìƒì„± ë° í™œì„±í™”
python -m venv rag-env
source rag-env/bin/activate  # Linux/Mac
# rag-env\Scripts\activate  # Windows

# í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜
pip install -r requirements.txt
```

### í•„ìˆ˜ íŒ¨í‚¤ì§€ ëª©ë¡

```
langchain==0.1.0
faiss-cpu==1.7.4
sentence-transformers==2.2.2
rank-bm25==0.2.2
matplotlib==3.7.2
seaborn==0.12.2
plotly==5.17.0
pandas==2.0.3
numpy==1.24.3
scikit-learn==1.3.0
ipywidgets==8.1.1
```

## ğŸ“– ë…¸íŠ¸ë¶ë³„ ìƒì„¸ ê°€ì´ë“œ

### 00. RAG ì´ë¡  ê°œìš” (`00_day2_rag_theory.ipynb`)
**í•™ìŠµ ëª©í‘œ**: RAG ì‹œìŠ¤í…œì˜ ì „ì²´ì ì¸ ì§„í™” ê³¼ì •ê³¼ ê° ë‹¨ê³„ë³„ í•µì‹¬ ê°œë… ì´í•´

- **Naive RAG (20ë¶„)**: ê¸°ë³¸ êµ¬ì¡°ì™€ í•œê³„ì 
- **Advanced RAG (30ë¶„)**: Query Refinement, Metadata Filtering, Hybrid Search
- **Modular RAG (15ë¶„)**: ì ì‘í˜• ë¼ìš°íŒ…, Self-RAG, í”„ë¡œë•ì…˜ ê³ ë ¤ì‚¬í•­

### 01. Naive RAG ë² ì´ìŠ¤ë¼ì¸ (`01_naive_rag_baseline.ipynb`)
**í•™ìŠµ ëª©í‘œ**: ê¸°ë³¸ RAG ì‹œìŠ¤í…œ êµ¬ì¶• ë° ì„±ëŠ¥ ì¸¡ì • ì‹œìŠ¤í…œ êµ¬í˜„

í•µì‹¬ êµ¬í˜„:
- FAISS ë²¡í„° ìŠ¤í† ì–´ êµ¬ì¶•
- LangChain ê¸°ë°˜ RAG ì²´ì¸
- ì„±ëŠ¥ ì¸¡ì • ëŒ€ì‹œë³´ë“œ
- í•œê¸€ ì§€ì› ì‹œê°í™”

```python
# í•µì‹¬ ì½”ë“œ ì˜ˆì‹œ
class RAGPerformanceTracker:
    def measure_query_performance(self, rag_chain, query, expected_keywords):
        # ì‘ë‹µ ì‹œê°„, í‚¤ì›Œë“œ ì»¤ë²„ë¦¬ì§€, ì»¨í…ìŠ¤íŠ¸ ê¸¸ì´ ì¸¡ì •
        pass
```

### 02. ì‹¤íŒ¨ ì‚¬ë¡€ ë¶„ì„ (`02_naive_failure_analysis.ipynb`)
**í•™ìŠµ ëª©í‘œ**: Naive RAGì˜ êµ¬ì²´ì  ì‹¤íŒ¨ íŒ¨í„´ ë¶„ì„ ë° ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ êµ¬ì¶•

5ê°€ì§€ ì£¼ìš” ì‹¤íŒ¨ íŒ¨í„´:
1. **ì˜ë¯¸ì  ì°¨ì´ (Semantic Gap)**: ì§ˆë¬¸ê³¼ ë¬¸ì„œì˜ í‘œí˜„ ë°©ì‹ ë¶ˆì¼ì¹˜
2. **ì»¨í…ìŠ¤íŠ¸ íŒŒí¸í™”**: ê¸´ ë‚´ìš©ì˜ ì²­í¬ ë¶„í• ë¡œ ì¸í•œ ë§¥ë½ ì†ì‹¤
3. **ëª¨í˜¸í•œ ì§ˆë¬¸**: ë¶ˆëª…í™•í•œ ì§ˆì˜ë¡œ ì¸í•œ ì˜ëª»ëœ ê²€ìƒ‰
4. **ì˜¤ë˜ëœ ì •ë³´**: ìµœì‹  ì •ë³´ ìš”êµ¬ vs êµ¬ ë²„ì „ ë¬¸ì„œ
5. **ë‚®ì€ ê´€ë ¨ì„± ìˆœìœ„**: ì¤‘ìš”í•œ ë¬¸ì„œì˜ ë‚®ì€ ê²€ìƒ‰ ìˆœìœ„

### 03. ê³ ê¸‰ ì¿¼ë¦¬ ê°œì„  (`03_advanced_query_refinement.ipynb`)
**í•™ìŠµ ëª©í‘œ**: ë‹¤ì–‘í•œ ì¿¼ë¦¬ ê°œì„  ê¸°ë²•ìœ¼ë¡œ ê²€ìƒ‰ í’ˆì§ˆ í–¥ìƒ

êµ¬í˜„ ê¸°ë²•:
- **Multi-Query Generation**: ë‹¤ì–‘í•œ ê´€ì ì˜ ì¿¼ë¦¬ ìƒì„±
- **Sub-Question Decomposition**: ë³µí•© ì§ˆë¬¸ì˜ ë‹¨ê³„ì  ë¶„í•´
- **Query Expansion**: ë™ì˜ì–´/ê´€ë ¨ì–´ í™œìš© ê²€ìƒ‰ ë²”ìœ„ í™•ì¥
- **RAG-Fusion**: Reciprocal Rank Fusionìœ¼ë¡œ ê²°ê³¼ í†µí•©

### 04. ë©”íƒ€ë°ì´í„° í•„í„°ë§ (`04_metadata_filtering.ipynb`)
**í•™ìŠµ ëª©í‘œ**: ì •í™•í•œ ë¬¸ì„œ ì„ ë³„ì„ ìœ„í•œ ë©”íƒ€ë°ì´í„° ê¸°ë°˜ í•„í„°ë§

í•„í„°ë§ ìœ í˜•:
- **ì‹œê°„ ê¸°ë°˜**: ì—°ë„, ìµœì‹  ê¸°ê°„ë³„ ë¬¸ì„œ ì„ ë³„
- **ì¹´í…Œê³ ë¦¬ ê¸°ë°˜**: ë„ë©”ì¸, ë‚œì´ë„ë³„ ë¶„ë¥˜
- **ë™ì  ì„ íƒ**: ì¿¼ë¦¬ ì˜ë„ ë¶„ì„ ê¸°ë°˜ ìë™ í•„í„° ì ìš©

### 05. í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ (`05_hybrid_search_rerank.ipynb`)
**í•™ìŠµ ëª©í‘œ**: í‚¤ì›Œë“œì™€ ì˜ë¯¸ ê²€ìƒ‰ì˜ ì¥ì ì„ ê²°í•©í•œ í•˜ì´ë¸Œë¦¬ë“œ ì‹œìŠ¤í…œ

í•µì‹¬ êµ¬ì„±:
- **BM25 + Vector Search**: í‚¤ì›Œë“œ ì •í™•ë„ + ì˜ë¯¸ì  ìœ ì‚¬ì„±
- **Reciprocal Rank Fusion**: ìˆœìœ„ ê¸°ë°˜ ê²°ê³¼ í†µí•©
- **Cross-encoder Re-ranking**: ì •ë°€í•œ ê´€ë ¨ì„± ì¬í‰ê°€
- **Multi-stage Pipeline**: ë‹¨ê³„ë³„ í’ˆì§ˆ í–¥ìƒ

### 06. ëª¨ë“ˆëŸ¬ RAG (`06_modular_rag_routing.ipynb`)
**í•™ìŠµ ëª©í‘œ**: ì§€ëŠ¥í˜• ë¼ìš°íŒ…ê³¼ ìê°€ ê²€ì¦ ê¸°ëŠ¥ì„ ê°–ì¶˜ ëª¨ë“ˆëŸ¬ ì‹œìŠ¤í…œ

í•µì‹¬ ëª¨ë“ˆ:
- **Query Router**: 6ê°€ì§€ ì§ˆë¬¸ ìœ í˜• ë¶„ë¥˜ ë° ì „ëµ ë¼ìš°íŒ…
- **Self-RAG**: ìê°€ ê²€ì¦ìœ¼ë¡œ í’ˆì§ˆ ë³´ì¥
- **Adaptive Selection**: ì„±ëŠ¥ ì´ë ¥ ê¸°ë°˜ ë™ì  ì „ëµ ì„ íƒ

### 07. ì¸í„°ë™í‹°ë¸Œ ë¹„êµ (`07_interactive_comparison.ipynb`)
**í•™ìŠµ ëª©í‘œ**: ëª¨ë“  RAG ë°©ë²•ì˜ ì¢…í•© ë¹„êµ ë° ë§ì¶¤í˜• ì¶”ì²œ

ì œê³µ ê¸°ëŠ¥:
- í†µí•© ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬
- ì‚¬ìš©ì ë§ì¶¤í˜• ì¶”ì²œ ì‹œìŠ¤í…œ
- ì‹¤ì‹œê°„ ì„±ëŠ¥ ë¹„êµ ë„êµ¬

## ğŸ¯ ì‹¤ë¬´ ì ìš© ê°€ì´ë“œ

### ë‹¨ê³„ë³„ êµ¬í˜„ ë¡œë“œë§µ

```mermaid
graph TD
    A[1ë‹¨ê³„: Naive RAG] --> B[2ë‹¨ê³„: ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§]
    B --> C[3ë‹¨ê³„: ì‹¤íŒ¨ íŒ¨í„´ ë¶„ì„]
    C --> D[4ë‹¨ê³„: Advanced ê¸°ë²• ì„ íƒ]
    D --> E[5ë‹¨ê³„: í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰]
    E --> F[6ë‹¨ê³„: ëª¨ë“ˆëŸ¬ RAG]
```

### ìƒí™©ë³„ ìµœì  ì „ëµ

| ìƒí™© | ì¶”ì²œ ë°©ë²• | ì´ìœ  |
|------|-----------|------|
| ğŸš€ ë¹ ë¥¸ í”„ë¡œí† íƒ€ì´í•‘ | Naive RAG | êµ¬í˜„ ê°„ë‹¨, ë¹ ë¥¸ ê²°ê³¼ |
| ğŸ¯ ë†’ì€ ì •í™•ë„ í•„ìš” | Hybrid Search | í‚¤ì›Œë“œ+ì˜ë¯¸ ê²€ìƒ‰ ê²°í•© |
| ğŸ’° ë¹„ìš© ìµœì í™” | Multi-Query + Metadata | íš¨ìœ¨ì  ì„±ëŠ¥ í–¥ìƒ |
| ğŸ­ í”„ë¡œë•ì…˜ í™˜ê²½ | Modular RAG | ìê°€ ìµœì í™”, í™•ì¥ì„± |

## ğŸ“Š ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬

| ë°©ë²• | ì •í™•ë„ | ì†ë„ | ë¹„ìš© íš¨ìœ¨ì„± | êµ¬í˜„ ë³µì¡ë„ |
|------|--------|------|-------------|-------------|
| Naive RAG | 0.65 | 0.95 | 0.80 | 0.10 |
| Multi-Query | 0.75 | 0.70 | 0.60 | 0.30 |
| Hybrid Search | 0.90 | 0.50 | 0.30 | 0.70 |
| Modular RAG | 0.95 | 0.40 | 0.10 | 0.90 |

## ğŸ› ï¸ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ìì£¼ ë°œìƒí•˜ëŠ” ë¬¸ì œì™€ í•´ê²°ì±…

#### 1. ë©”ëª¨ë¦¬ ë¶€ì¡± ì˜¤ë¥˜
```python
# í•´ê²°ì±…: ë°°ì¹˜ í¬ê¸° ì¡°ì •
embeddings = HuggingFaceEmbeddings(
    model_kwargs={'device': 'cpu'},
    encode_kwargs={'batch_size': 32}  # ê¸°ë³¸ê°’ë³´ë‹¤ ì‘ê²Œ
)
```

#### 2. í•œê¸€ ì²˜ë¦¬ ë¬¸ì œ
```python
# í•´ê²°ì±…: ì ì ˆí•œ í† í¬ë‚˜ì´ì € ì‚¬ìš©
from langchain.text_splitter import RecursiveCharacterTextSplitter

text_splitter = RecursiveCharacterTextSplitter(
    chunk_size=500,
    chunk_overlap=50,
    separators=["\n\n", "\n", " ", ""]
)
```

#### 3. FAISS ì¸ë±ìŠ¤ ì €ì¥/ë¡œë“œ
```python
# ì €ì¥
vector_store.save_local("faiss_index")

# ë¡œë“œ
vector_store = FAISS.load_local("faiss_index", embeddings)
```

## ğŸ”§ í™•ì¥ ê°€ì´ë“œ

### ìƒˆë¡œìš´ RAG ê¸°ë²• ì¶”ê°€

1. **ê¸°ë³¸ í´ë˜ìŠ¤ ìƒì†**
```python
class CustomRAGMethod(BaseRAGMethod):
    def search(self, query: str) -> List[Dict]:
        # ì»¤ìŠ¤í…€ ë¡œì§ êµ¬í˜„
        pass
```

2. **ì„±ëŠ¥ ì¸¡ì • ì¶”ê°€**
```python
performance_tracker.add_method("custom_method", CustomRAGMethod())
```

3. **ë¹„êµ ì‹œìŠ¤í…œì— ë“±ë¡**
```python
rag_comparison.register_method("custom", {
    "name": "Custom RAG",
    "description": "ì‚¬ìš©ì ì •ì˜ RAG ë°©ë²•"
})
```

## ğŸ“š ì°¸ê³  ìë£Œ

### ë…¼ë¬¸ ë° ì•„í‹°í´
- **RAG ì›ë³¸ ë…¼ë¬¸**: [Retrieval-Augmented Generation for Knowledge-Intensive NLP Tasks](https://arxiv.org/abs/2005.11401)
- **RAG-Fusion**: [RAG-Fusion: A New Take on Retrieval-Augmented Generation](https://arxiv.org/abs/2402.03367)
- **Self-RAG**: [Self-RAG: Learning to Retrieve, Generate and Critique through Self-reflection](https://arxiv.org/abs/2310.11511)

### ì˜¤í”ˆì†ŒìŠ¤ í”„ë¡œì íŠ¸
- [LangChain](https://github.com/langchain-ai/langchain): RAG íŒŒì´í”„ë¼ì¸ êµ¬ì¶•
- [LlamaIndex](https://github.com/run-llama/llama_index): ê³ ê¸‰ RAG ê¸°ëŠ¥
- [FAISS](https://github.com/facebookresearch/faiss): ë²¡í„° ê²€ìƒ‰ ì—”ì§„

## ğŸ¤ ê¸°ì—¬í•˜ê¸°

ì´ ì»¤ë¦¬í˜ëŸ¼ì˜ ê°œì„ ì‚¬í•­ì´ë‚˜ ìƒˆë¡œìš´ ê¸°ë²• ì¶”ê°€ë¥¼ ì›í•˜ì‹œë©´:

1. Issuesì— ì œì•ˆì‚¬í•­ ë“±ë¡
2. Pull Request ì œì¶œ
3. ì‹¤ìŠµ ê²°ê³¼ ê³µìœ 

## ğŸ“ ì§€ì›

- **ë¬¸ì˜**: ì‹¤ìŠµ ì¤‘ ë¬¸ì œê°€ ë°œìƒí•˜ë©´ Issuesì— ë“±ë¡í•´ì£¼ì„¸ìš”
- **í”¼ë“œë°±**: ê°œì„ ì‚¬í•­ì´ë‚˜ ì¶”ê°€ í¬ë§ ë‚´ìš©ì„ ì•Œë ¤ì£¼ì„¸ìš”
- **ì»¤ë®¤ë‹ˆí‹°**: ë‹¤ë¥¸ í•™ìŠµìë“¤ê³¼ ê²½í—˜ì„ ê³µìœ í•˜ì„¸ìš”

---

**ğŸ‰ Day 2 RAG ë§ˆìŠ¤í„° ê³¼ì •ì„ ì™„ì£¼í•˜ì—¬ RAG ì „ë¬¸ê°€ê°€ ë˜ì–´ë³´ì„¸ìš”!**

*ì´ ì»¤ë¦¬í˜ëŸ¼ì€ ìµœì‹  RAG ì—°êµ¬ì™€ ì‹¤ë¬´ ê²½í—˜ì„ ë°”íƒ•ìœ¼ë¡œ ì§€ì†ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.*